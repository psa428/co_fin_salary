{"ast":null,"code":"var _jsxFileName = \"/home/psa/develop/result-school/blog/src/pages/registration/registration.js\",\n  _s = $RefreshSig$();\nimport { useForm } from 'react-hook-form';\nimport { Link, Navigate } from 'react-router-dom';\nimport * as yup from 'yup';\nimport { yupResolver } from '@hookform/resolvers/yup';\nimport { server } from '../../bff/server';\nimport { useEffect, useState } from 'react';\nimport { Input, Button } from '../../components';\nimport styled from 'styled-components';\nimport { setUser } from '../../actions';\nimport { useDispatch, useSelector, useStore } from 'react-redux';\nimport { selectUserRole } from '../../selectors';\nimport { ROLE } from '../../bff/session';\nimport { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\nconst regFormSchema = yup.object().shape({\n  login: yup.string().required('Введите логин').matches(/^\\w+$/, 'Неверный логин. Допускаются только буквы и цифры').min(3, 'Неверный логин. Длина должна быть не менее 3 цифр').max(15, 'Неверный логин. Длина не более 15 символов'),\n  password: yup.string().required('Введите пароль').matches(/^[\\w#%]+$/, 'Неверный пароль. Допускаяются буквы, цифры и символы # %').min(6, 'Длина пароля не менее 8 символов').max(15, 'Длина пароле не более 15 символов'),\n  passcheck: yup.string().required('Заполните повтор пароля').oneOf([yup.ref('password'), null], 'Повтор пароля не совпадает')\n});\nconst ErrorMessage = styled.div`\n    font-size:  18px;\n    margin: 10px 0 0;\n    padding:    10px;\n    background-color:   #fcadad;   \n`;\n_c = ErrorMessage;\nconst RegistrationContainer = ({\n  className\n}) => {\n  _s();\n  var _errors$login, _errors$password, _errors$passcheck;\n  const {\n    register,\n    reset,\n    handleSubmit,\n    formState: {\n      errors\n    }\n  } = useForm({\n    defaultValues: {\n      login: '',\n      password: '',\n      passcheck: ''\n    },\n    resolver: yupResolver(regFormSchema)\n  });\n  const [servseError, setServerError] = useState(null);\n  const store = useStore();\n  const dispatch = useDispatch();\n  const roleId = useSelector(selectUserRole);\n  useEffect(() => {\n    let currentWasLogout = store.getState().app.wasLogout;\n    return store.subscribe(() => {\n      let previousWasLogout = currentWasLogout;\n      currentWasLogout = store.getState().app.wasLogout;\n      if (currentWasLogout !== previousWasLogout) {\n        reset();\n      }\n    });\n  }, [reset, store]);\n  const onSubmit = ({\n    login,\n    password\n  }) => {\n    server.register(login, password).then(({\n      error,\n      res\n    }) => {\n      console.log(`in RegistrationContainer error = ${error} `);\n      // console.log(`in RegistrationContainer res.roleId = ${res.roleId}`);\n      if (error) {\n        setServerError(`Ошибка запроса: ${error}`);\n      }\n      dispatch(setUser(res));\n    });\n  };\n  const formError = ((_errors$login = errors.login) === null || _errors$login === void 0 ? void 0 : _errors$login.message) || (errors === null || errors === void 0 ? void 0 : (_errors$password = errors.password) === null || _errors$password === void 0 ? void 0 : _errors$password.message) || (errors === null || errors === void 0 ? void 0 : (_errors$passcheck = errors.passcheck) === null || _errors$passcheck === void 0 ? void 0 : _errors$passcheck.message);\n  const errorMessage = formError || servseError;\n  if (roleId !== ROLE.GUEST) {\n    return /*#__PURE__*/_jsxDEV(Navigate, {\n      to: \"/\"\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 100,\n      columnNumber: 16\n    }, this);\n  }\n  return /*#__PURE__*/_jsxDEV(\"div\", {\n    className: className,\n    children: [/*#__PURE__*/_jsxDEV(\"h2\", {\n      children: \"\\u0420\\u0435\\u0433\\u0438\\u0441\\u0442\\u0440\\u0430\\u0446\\u0438\\u044F\"\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 106,\n      columnNumber: 13\n    }, this), /*#__PURE__*/_jsxDEV(\"form\", {\n      onSubmit: handleSubmit(onSubmit),\n      children: [/*#__PURE__*/_jsxDEV(Input, {\n        type: \"text\",\n        placeholder: \"\\u041B\\u043E\\u0433\\u0438\\u043D...\",\n        ...register('login', {\n          onChange: () => setServerError(null)\n        })\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 108,\n        columnNumber: 17\n      }, this), /*#__PURE__*/_jsxDEV(Input, {\n        type: \"password\",\n        placeholder: \"\\u041F\\u0430\\u0440\\u043E\\u043B\\u044C...\",\n        ...register('password', {\n          onChange: () => setServerError(null)\n        })\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 114,\n        columnNumber: 17\n      }, this), /*#__PURE__*/_jsxDEV(Input, {\n        type: \"password\",\n        placeholder: \"\\u041F\\u0440\\u043E\\u0432\\u0435\\u0440\\u043A\\u0430 \\u043F\\u0430\\u0440\\u043E\\u043B\\u044F...\",\n        ...register('passcheck', {\n          onChange: () => setServerError(null)\n        })\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 120,\n        columnNumber: 17\n      }, this), /*#__PURE__*/_jsxDEV(Button, {\n        type: \"submit\",\n        disabled: !!formError,\n        children: \"\\u0417\\u0430\\u0440\\u0435\\u0433\\u0438\\u0441\\u0442\\u0440\\u0438\\u0440\\u043E\\u0432\\u0430\\u0442\\u044C\\u0441\\u044F\"\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 126,\n        columnNumber: 17\n      }, this), errorMessage && /*#__PURE__*/_jsxDEV(ErrorMessage, {\n        children: errorMessage\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 129,\n        columnNumber: 34\n      }, this)]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 107,\n      columnNumber: 13\n    }, this)]\n  }, void 0, true, {\n    fileName: _jsxFileName,\n    lineNumber: 105,\n    columnNumber: 9\n  }, this);\n};\n_s(RegistrationContainer, \"IYSjldjEipXm6qCzDnDjw31QhfQ=\", false, function () {\n  return [useForm, useStore, useDispatch, useSelector];\n});\n_c2 = RegistrationContainer;\nexport const Registration = styled(RegistrationContainer)`\n    display:    flex;\n    flex-direction: column;\n    align-items:   center;\n\n    & > form {\n        display:    flex;\n        flex-direction: column;\n        width:  260px;\n    }\n    \n\n`;\nvar _c, _c2;\n$RefreshReg$(_c, \"ErrorMessage\");\n$RefreshReg$(_c2, \"RegistrationContainer\");","map":{"version":3,"names":["useForm","Link","Navigate","yup","yupResolver","server","useEffect","useState","Input","Button","styled","setUser","useDispatch","useSelector","useStore","selectUserRole","ROLE","jsxDEV","_jsxDEV","regFormSchema","object","shape","login","string","required","matches","min","max","password","passcheck","oneOf","ref","ErrorMessage","div","_c","RegistrationContainer","className","_s","_errors$login","_errors$password","_errors$passcheck","register","reset","handleSubmit","formState","errors","defaultValues","resolver","servseError","setServerError","store","dispatch","roleId","currentWasLogout","getState","app","wasLogout","subscribe","previousWasLogout","onSubmit","then","error","res","console","log","formError","message","errorMessage","GUEST","to","fileName","_jsxFileName","lineNumber","columnNumber","children","type","placeholder","onChange","disabled","_c2","Registration","$RefreshReg$"],"sources":["/home/psa/develop/result-school/blog/src/pages/registration/registration.js"],"sourcesContent":["import { useForm } from 'react-hook-form';\nimport { Link, Navigate } from 'react-router-dom';\nimport * as yup from 'yup';\nimport { yupResolver } from '@hookform/resolvers/yup';\nimport { server } from '../../bff/server';\nimport { useEffect, useState } from 'react';\nimport { Input, Button } from '../../components';\n\nimport styled from 'styled-components';\nimport { setUser } from '../../actions';\nimport { useDispatch, useSelector, useStore } from 'react-redux';\nimport { selectUserRole } from '../../selectors';\nimport { ROLE } from '../../bff/session';\n\nconst regFormSchema = yup.object().shape({\n    login:  yup.string()\n        .required('Введите логин')\n        .matches(/^\\w+$/, 'Неверный логин. Допускаются только буквы и цифры')\n        .min(3, 'Неверный логин. Длина должна быть не менее 3 цифр')\n        .max(15, 'Неверный логин. Длина не более 15 символов'),\n    password:   yup.string()\n        .required ('Введите пароль') \n        .matches(/^[\\w#%]+$/, 'Неверный пароль. Допускаяются буквы, цифры и символы # %')\n        .min(6, 'Длина пароля не менее 8 символов')  \n        .max(15, 'Длина пароле не более 15 символов'),\n    passcheck:    yup\n        .string()\n        .required('Заполните повтор пароля')\n        .oneOf([yup.ref('password'), null], 'Повтор пароля не совпадает'),\n\n\n});\n\n\nconst ErrorMessage = styled.div`\n    font-size:  18px;\n    margin: 10px 0 0;\n    padding:    10px;\n    background-color:   #fcadad;   \n`;\n \n\nconst RegistrationContainer = ({ className }) => {\n    const {\n        register,\n        reset,\n        handleSubmit,\n        formState:  { errors }\n\n    } = useForm({\n        defaultValues:  {\n            login:  '',\n            password:   '',\n            passcheck:  '',\n        },\n        resolver:   yupResolver(regFormSchema),\n\n    });\n\n    const [servseError, setServerError] = useState(null);\n\n    const store = useStore();\n    const dispatch = useDispatch();\n\n    const roleId = useSelector(selectUserRole);\n\n    useEffect(() => {\n        let currentWasLogout = store.getState().app.wasLogout;\n\n        return store.subscribe(() => {\n            let previousWasLogout = currentWasLogout;\n            currentWasLogout = store.getState().app.wasLogout;\n\n            if (currentWasLogout !== previousWasLogout) {\n                reset();\n            }\n        });\n\n    }, [reset, store]);\n\n    const onSubmit = ({ login, password}) => {\n        \n        server.register(login, password).then(({error, res}) => {\n            console.log(`in RegistrationContainer error = ${error} `);\n            // console.log(`in RegistrationContainer res.roleId = ${res.roleId}`);\n            if (error) {  \n                setServerError(`Ошибка запроса: ${error}`);\n            }\n\n            dispatch(setUser(res));\n        })\n\n    };\n\n    const formError = errors.login?.message || errors?.password?.message || errors?.passcheck?.message ;\n\n    const errorMessage = formError || servseError;\n\n    if (roleId !== ROLE.GUEST) {\n        return <Navigate to=\"/\"></Navigate>\n\n    }\n\n    return (\n        <div className={className}>\n            <h2>Регистрация</h2>\n            <form onSubmit={handleSubmit(onSubmit)}>\n                <Input \n                    type=\"text\" \n                    placeholder=\"Логин...\" \n                    {...register('login', {\n                        onChange: () => setServerError(null),\n                    })} />\n                <Input type=\"password\" \n                    placeholder=\"Пароль...\" \n                    {...register('password', {\n                        onChange: () => setServerError(null),\n                    })}\n                />\n                <Input type=\"password\" \n                    placeholder=\"Проверка пароля...\" \n                    {...register('passcheck', {\n                        onChange: () => setServerError(null),\n                    })}\n                />\n                <Button type=\"submit\" disabled={!!formError}>\n                    Зарегистрироваться\n                </Button>\n                {errorMessage && <ErrorMessage>{errorMessage}</ErrorMessage>}\n                \n                \n            </form>\n\n\n        </div>\n\n    );\n};\n\nexport const Registration = styled(RegistrationContainer)`\n    display:    flex;\n    flex-direction: column;\n    align-items:   center;\n\n    & > form {\n        display:    flex;\n        flex-direction: column;\n        width:  260px;\n    }\n    \n\n`;"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}